<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - LR Gourmet</title>
    <!-- Bootstrap, FontAwesome e fontes para layout e ícones -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- CSS principal do dashboard -->
    <link rel="stylesheet" href="dashboard-style.css">
    <style>
        /* Grupo de ações da imagem (crop, thumb, lixeira) como um bloco compacto */
        .image-actions-group { display:inline-flex; align-items:center; white-space:nowrap; gap:8px; }
        /* Ajustes para larguras intermediárias: diminuir os elementos para caber em linha */
        @media (max-width: 768px) {
            .image-actions-group img { width:48px; height:48px; }
            .image-actions-group .btn { padding:4px 8px; }
        }
        /* Fallback: em telas estreitas, substitui o grupo por um botão de Preview */
        @media (max-width: 768px) {
            .image-actions-group { display:none !important; }
            #imageActionsPreviewBtn { display:inline-block !important; }
        }
        @media (min-width: 769px) {
            #imageActionsPreviewBtn { display:none !important; }
        }
        /* Nome do arquivo abaixo em telas muito pequenas */
        @media (max-width: 500px) {
            #productImageFilename { display:block !important; width:100%; }
        }
    </style>
    <!-- Cropper.js para recorte de imagens -->
    <link rel="stylesheet" href="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.css">
    <!-- Bibliotecas JS para gráficos e datas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>

    <!-- Ícone do site -->
    <link rel="icon" type="image/png" href="icon.png" sizes= "192x192"/>

    <!-- Metadados para compartilhamento -->
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="LR Gourmet"/>
    <meta property="og:image" content="https://lrgourmet.com.br/logo.html"/>
    <meta property="og:description" content="Delícias que encantam o paladar!"/>
    <meta property="og:site_name" content="LRgourmet"/> 
</head>
<body>
    <!-- Overlay para mobile (bloqueia fundo quando sidebar está aberta) -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Modal de Login (acesso restrito) -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Acesso Restrito - Superusuários
                    </h5>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="username">
                                <i class="fas fa-user mr-2"></i>Usuário
                            </label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="form-group">
                            <label for="password">
                                <i class="fas fa-lock mr-2"></i>Senha
                            </label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="alert alert-danger d-none" id="loginError">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Credenciais inválidas!
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-block" id="loginBtn">
                        <i class="fas fa-sign-in-alt mr-2"></i>Entrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar de navegação principal -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h4><i class="fas fa-chart-line mr-2"></i>LR Dashboard</h4>
            <button class="btn btn-link text-white d-md-none" id="sidebarToggle">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="sidebar-nav">
            <!-- Links de navegação para cada seção do dashboard -->
            <a href="#overview" class="nav-link active" data-section="overview">
                <i class="fas fa-tachometer-alt"></i>
                <span>Visão Geral</span>
            </a>
            <a href="#products" class="nav-link" data-section="products">
                <i class="fas fa-box"></i>
                <span>Produtos</span>
            </a>
            <a href="#add-products" class="nav-link" data-section="add-products">
                <i class="fas fa-plus-circle"></i>
                <span>Adicionar Produtos</span>
            </a>
            <a href="#precificacao" class="nav-link" data-section="precificacao">
                <i class="fas fa-calculator"></i>
                <span>Precificação</span>
            </a>
               <a href="#horarios" class="nav-link" data-section="horarios">
                   <i class="fas fa-clock"></i>
                   <span>Horários</span>
               </a>
            <a href="#customers" class="nav-link" data-section="customers">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </a>
            <a href="#locations" class="nav-link" data-section="locations">
                <i class="fas fa-map-marker-alt"></i>
                <span>Localização</span>
            </a>
            <a href="#reports" class="nav-link" data-section="reports">
                <i class="fas fa-file-alt"></i>
                <span>Relatórios</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <!-- Botão de logout e ações rápidas para mobile -->
            <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                <i class="fas fa-sign-out-alt mr-2"></i>Sair
            </button>
            <!-- Botões de atualizar e lixeira para mobile -->
            <div class="d-block d-md-none mt-3">
                <button class="btn btn-primary btn-sm mr-2" id="refreshDataMobile">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn btn-danger btn-sm" id="clearAllDataMobile" title="Zerar Todos os Dados">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Conteúdo principal do dashboard -->
    <div class="main-content" id="mainContent">
    <!-- Cabeçalho do dashboard -->
    <header class="dashboard-header">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <button class="btn btn-primary d-md-none mr-0" id="menuToggle" type="button">
                        <i class="fas fa-bars"></i>
                        <span class="ml-2 d-none d-sm-inline">Menu</span>
                    </button>
                    <h2 class="mb-0 dashboard-title">
                        <span class="d-inline d-dashboard-long">Dashboard de Vendas</span>
                        <span class="d-none d-dashboard-short">Dashboard</span>
                    </h2>
                </div>
                <div class="d-flex align-items-center">
                    <div class="date-filter mr-3">
                        <select class="form-control form-control-sm" id="dateFilter">
                            <option value="today">Hoje</option>
                            <option value="week">Esta Semana</option>
                            <option value="month" selected>Este Mês</option>
                            <option value="quarter">Este Trimestre</option>
                            <option value="year">Este Ano</option>
                        </select>
                    </div>
                    <button class="btn btn-primary btn-sm mr-2 d-none d-md-inline" id="refreshData">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button class="btn btn-danger btn-sm d-none d-md-inline" id="clearAllData" title="Zerar Todos os Dados">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        </header>
    <!-- Seção de Precificação de Produtos -->
    <div class="content-section" id="precificacao-section" style="display:none;">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-cubes mr-2"></i>Cadastro de Produtos para Precificação</h5>
                        </div>
                        <div class="card-body">
                            <form id="precificacaoProdutoForm">
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label>Nome do Produto</label>
                                        <input type="text" class="form-control" id="precNomeProduto" required>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label>Valor Total (R$)</label>
                                        <input type="number" class="form-control" id="precValorProduto" step="0.01" min="0" required>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label>Quantidade</label>
                                        <input type="number" class="form-control" id="precQtdProduto" min="1" required>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label>Valor por Unidade (R$)</label>
                                        <input type="text" class="form-control" id="precValorUnProduto" readonly>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Salvar Produto</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-box-open mr-2"></i>Cadastro de Embalagens</h5>
                        </div>
                        <div class="card-body">
                            <form id="precificacaoEmbalagemForm">
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label>Nome da Embalagem</label>
                                        <input type="text" class="form-control" id="precNomeEmbalagem" required>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label>Valor Total (R$)</label>
                                        <input type="number" class="form-control" id="precValorEmbalagem" step="0.01" min="0" required>
                                    </div>
                                    <div class="form-group col-md-3">
                                        <label>Quantidade</label>
                                        <input type="number" class="form-control" id="precQtdEmbalagem" min="1" required>
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label>Valor por Unidade (R$)</label>
                                        <input type="text" class="form-control" id="precValorUnEmbalagem" readonly>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">Salvar Embalagem</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-balance-scale mr-2"></i>Precificar Produto Final</h5>
                        </div>
                        <div class="card-body">
                            <form id="precificacaoFinalForm">
                                <div class="form-row align-items-end">
                                    <div class="form-group col-md-4">
                                        <label>Nome do Produto Final</label>
                                        <input type="text" class="form-control" id="precNomeFinal" required placeholder="Digite o nome do produto que será precificado">
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label>Rendimento</label>
                                        <input type="number" class="form-control" id="precRendimento" min="1" placeholder="Informe o rendimento total da receita">
                                    </div>
                                    <div class="form-group col-md-2">
                                        <label>Mão de Obra (%)</label>
                                        <input type="number" class="form-control" id="precMaoObra" min="0" max="100" placeholder="Percentual de mão de obra">
                                    </div>
                                    <div class="form-group col-md-4">
                                        <button type="button" class="btn btn-success" id="addItemPrecificacao">Adicionar Item</button>
                                    </div>
                                </div>
                                <div id="precItensContainer"></div>
                                <small class="text-muted">.</small>
                                <button type="submit" class="btn btn-primary mt-3">Calcular Precificação</button>
<button type="button" class="btn btn-primary mt-3 ml-2" id="addPrecToCardapio">Adicionar ao Cardápio</button>
                                <!-- JS para atualizar texto do select de produto/embalagem -->
                                <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    $(document).on('change', '.precItemSelect', function() {
                                        var selected = $(this).find('option:selected').text();
                                        if (selected && selected !== 'Selecione Produto/Embalagem') {
                                            $(this).find('option[value=""]').text(selected);
                                        } else {
                                            $(this).find('option[value=""]').text('Selecione Produto/Embalagem');
                                        }
                                    });
                                });
                                </script>
                            </form>
                            <div id="precResultado" class="mt-4"></div>
<div id="precListasDinamicas" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

    <!-- Seção Visão Geral (KPIs, gráficos, pedidos recentes) -->
    <div class="content-section active" id="overview-section">
            <!-- Cartões de KPIs principais -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-success">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="totalRevenue">R$ 0,00</h3>
                            <p>Receita Total</p>
                            <small class="text-success">
                                <i class="fas fa-arrow-up"></i>
                                <span id="revenueGrowth">+0%</span> vs período anterior
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-info">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="totalOrders">0</h3>
                            <p>Pedidos Totais</p>
                            <small class="text-info">
                                <i class="fas fa-arrow-up"></i>
                                <span id="ordersGrowth">+0%</span> vs período anterior
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-warning">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="totalProducts">0</h3>
                            <p>Produtos Vendidos</p>
                            <small class="text-warning">
                                <i class="fas fa-arrow-up"></i>
                                <span id="productsGrowth">+0%</span> vs período anterior
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-danger">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="avgOrderValue">R$ 0,00</h3>
                            <p>Ticket Médio</p>
                            <small class="text-danger">
                                <i class="fas fa-arrow-up"></i>
                                <span id="avgOrderGrowth">+0%</span> vs período anterior
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráficos de receita e formas de pagamento -->
            <div class="row mb-4">
                <div class="col-lg-8 mb-4">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h5><i class="fas fa-chart-line mr-2"></i>Receita por Período</h5>
                            <div class="chart-controls">
                                <button class="btn btn-sm btn-outline-primary active" data-chart="revenue">Receita</button>
                                <button class="btn btn-sm btn-outline-primary" data-chart="orders">Pedidos</button>
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h5><i class="fas fa-chart-pie mr-2"></i>Formas de Pagamento</h5>
                        </div>
                        <div class="chart-body">
                            <canvas id="paymentChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabela de pedidos recentes -->
            <div class="row">
                <div class="col-12">
                    <div class="table-card">
                        <div class="table-header">
                            <h5><i class="fas fa-clock mr-2"></i>Pedidos Recentes</h5>
                            <button class="btn btn-sm btn-outline-primary" id="exportOrders">
                                <i class="fas fa-download mr-2"></i>Exportar
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="recentOrdersTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Cliente</th>
                                        <th>Itens</th>
                                        <th>Total</th>
                                        <th>Pagamento</th>
                                        <th>Status</th>
                                        <th>Data</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados serão inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Seção de Produtos (gerenciamento, ranking, gráficos) -->
    <div class="content-section" id="products-section">
            <!-- Painel de gerenciamento de disponibilidade de produtos -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>
                        <i class="fas fa-cogs"></i>
                        <span class="d-inline d-produtos-long">Gerenciar Disponibilidade de Produtos</span>
                        <span class="d-none d-produtos-short">Gerenciar Produtos</span>
                    </h5>
                    <div id="productActionsHeaderMount">
                        <div id="productActionsContainer" class="text-right">
                            <button class="btn btn-success btn-sm" id="enableAllProducts" title="Ativar Todos">
                                <i class="fas fa-check-circle mr-1"></i>
                                <span class="btn-text">Ativar Todos</span>
                            </button>
                            <button class="btn btn-warning btn-sm" id="disableAllProducts" title="Desativar Todos">
                                <i class="fas fa-times-circle mr-1"></i>
                                <span class="btn-text">Desativar Todos</span>
                            </button>
                            <button class="btn btn-danger btn-sm ml-2" id="resetAllProducts" title="Zerar todos os produtos do site">
                                <i class="fas fa-trash-alt mr-1"></i>
                                <span class="btn-text">Zerar Produtos</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Mount para ações quando largura < 1300px -->
                    <div id="productActionsMobileMount" class="mb-3 d-none"></div>
                    <!-- Filtros de página -->
                    <div class="mb-3" id="productPageFilters">
                        <button type="button" class="btn btn-outline-primary mr-2 active" data-page="index">Página Inicial</button>
                        <button type="button" class="btn btn-outline-primary mr-2" data-page="cardapio">Cardápio</button>
                        <button type="button" class="btn btn-outline-primary" data-page="pistache">Pistache</button>
                    </div>
                    <!-- Filtro de seção (dinâmico) -->
                    <div class="mb-3" id="productSectionFilterBar">
                        <label for="productSectionFilter" class="mr-2">Seção:</label>
                        <select class="form-control form-control-sm d-inline-block" id="productSectionFilter" style="max-width: 260px;">
                            <option value="all">Todas as seções</option>
                        </select>
                    </div>
                    <div class="row" id="productManagementGrid">
                        <!-- Produtos serão carregados aqui via JS -->
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5>Produtos Mais Vendidos</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="topProductsChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <h5>Produtos Menos Vendidos</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="lowProductsChart" height="300"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tabela de ranking de produtos -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>Ranking Completo de Produtos</h5>
                    <div class="chart-controls">
                        <button class="btn btn-sm btn-outline-primary" id="exportProducts">
                            <i class="fas fa-download mr-1"></i>Exportar
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped" id="productsRankingTable">
                            <thead>
                                <tr>
                                    <th>Posição</th>
                                    <th>Produto</th>
                                    <th>Status</th>
                                    <th>Vendas</th>
                                    <th>Receita</th>
                                    <th>Crescimento</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- Dados serão preenchidos via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    <!-- Seção para adicionar novos produtos -->
    <div class="content-section" id="add-products-section">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-plus-circle mr-2"></i>Adicionar Novo Produto</h5>
                        </div>
                        <div class="card-body">
                            <form id="addProductForm">
                                <div class="container-fluid px-0">
                                    <div class="row">
                                        <div class="col-lg-6 col-md-12 mb-3">
                                            <label for="productName" class="form-label">Nome do Produto *</label>
                                            <input type="text" class="form-control" id="productName" required>
                                        </div>
                                        <div class="col-lg-6 col-md-12 mb-3">
                                            <label for="productPrice" class="form-label">Valor do Produto *</label>
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">R$</span>
                                                </div>
                                                <input type="number" class="form-control" id="productPrice" step="0.01" min="0" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6 col-md-12 mb-3">
                                            <label for="productStock" class="form-label">Estoque Inicial</label>
                                            <input type="number" class="form-control" id="productStock" min="0" step="1" placeholder="Ex.: 50">
                                            <small class="form-text text-muted">Se deixar em branco, não limitaremos a quantidade (estoque ilimitado).</small>
                                        </div>
                                        <div class="col-lg-6 col-md-12 mb-3">
                                            <label for="productImage" class="form-label">Imagem do Produto</label>
                                            <div class="d-flex align-items-center flex-wrap" style="gap:12px;">
                                                <div class="custom-file" style="display:inline-block;width:auto;min-width:220px;">
                                                    <input type="file" class="custom-file-input" id="productImage" accept="image/*">
                                                    <label class="custom-file-label" for="productImage" data-browse="Escolher arquivo">Escolher arquivo</label>
                                                </div>
                                                <small id="productImageFilename" class="text-muted" style="display:none;"></small>
                                                <div class="image-actions-group">
                                                    <button type="button" class="btn btn-sm btn-outline-primary" id="cropImageBtn" style="display:none;" title="Recortar">
                                                        <i class="fas fa-crop-alt"></i>
                                                    </button>
                                                    <img id="productImagePreview" src="" alt="Preview" style="display:none;width:64px;height:64px;object-fit:cover;border-radius:4px;border:1px solid #eee;" />
                                                    <button type="button" class="btn btn-sm btn-outline-danger" id="removeProductImage" style="display:none;" title="Remover imagem">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                                <button type="button" id="imageActionsPreviewBtn" class="btn btn-sm btn-outline-primary" title="Pré-visualizar" style="display:none;">
                                                    Preview
                                                </button>
                                            </div>
                                            <small class="form-text text-muted">Selecione uma imagem (PNG, JPG, SVG, etc.)</small>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6 col-md-12 mb-3">
                                            <label for="productPage" class="form-label">Página *</label>
                                            <select class="form-control" id="productPage" required style="height: 38px; text-align: center;">
                                                <option value="">Selecione a página</option>
                                                <option value="index">Página Inicial</option>
                                                <option value="cardapio">Cardápio</option>
                                                <option value="pistache">Pistache</option>
                                            </select>
                                        </div>
                                        <div class="col-lg-6 col-md-12 mb-3">
                                            <label for="productSection" class="form-label">Seção *</label>
                                            <select class="form-control" id="productSection" required style="height: 38px; text-align: center;">
                                                <option value="">Selecione a seção</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 mb-3">
                                            <label for="productDescription" class="form-label">Descrição do Produto *</label>
                                            <textarea class="form-control" id="productDescription" rows="3" required></textarea>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-plus mr-2"></i>Adicionar Produto
                                            </button>
                                            <button type="button" class="btn btn-secondary ml-2" id="clearForm">
                                                <i class="fas fa-eraser mr-2"></i>Limpar Formulário
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- JS para atualizar seções conforme página selecionada -->
            <script>
            const sectionsByPage = {
                index: [
                    { value: 'doces', label: 'Doces' },
                    { value: 'bebidas', label: 'Bebidas' }
                ],
                cardapio: [
                    { value: 'doces-no-pote', label: 'Doces no Pote' },
                    { value: 'bebidas', label: 'Bebidas' },
                    { value: 'trufas-ao-leite', label: 'Trufas ao Leite' },
                    { value: 'trufas-brancas', label: 'Trufas Brancas' }
                ],
                pistache: [
                    { value: 'trufas-de-pistache', label: 'Trufas de Pistache' },
                    { value: 'casquinha-de-pistache', label: 'Casquinha de Pistache' }
                ]
            };
            document.getElementById('productPage').addEventListener('change', function() {
                const page = this.value;
                const sectionSelect = document.getElementById('productSection');
                sectionSelect.innerHTML = '<option value="">Selecione a seção</option>';
                if (sectionsByPage[page]) {
                    sectionsByPage[page].forEach(sec => {
                        const opt = document.createElement('option');
                        opt.value = sec.value;
                        opt.textContent = sec.label;
                        sectionSelect.appendChild(opt);
                    });
                }
            });
            </script>

            <!-- Products List -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center added-products-header">
                            <h5><i class="fas fa-list mr-2"></i>Produtos Adicionados</h5>
                            <div id="addedProductsActions" class="actions-toolbar">
                                <button class="btn btn-success btn-sm" id="exportProductsList" title="Exportar lista de produtos adicionados">
                                    <i class="fas fa-download mr-1"></i><span class="btn-text">Exportar Lista</span>
                                </button>
                                <button class="btn btn-danger btn-sm" id="purgeCustomProducts" title="Apagar todos os produtos do site (páginas públicas)">
                                    <i class="fas fa-trash mr-1"></i><span class="btn-text">Apagar Todos</span>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="addedProductsTable">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Categoria</th>
                                            <th>Preço</th>
                                            <th>Descrição</th>
                                            <th>Imagem</th>
                                            <th>Estoque</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="addedProductsTableBody">
                                        <!-- Produtos adicionados serão exibidos aqui -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção de Horários de Funcionamento -->
    <div class="content-section" id="horarios-section">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="fas fa-clock mr-2"></i>Horários de Funcionamento</h5>
                        </div>
                        <div class="card-body">
                            <form id="horariosForm">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Dia</th>
                                                <th>Abertura</th>
                                                <th>Fechamento</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Domingo</td>
                                                <td><select class="form-control" id="open-0"></select></td>
                                                <td><select class="form-control" id="close-0"></select></td>
                                            </tr>
                                            <tr>
                                                <td>Segunda</td>
                                                <td><select class="form-control" id="open-1"></select></td>
                                                <td><select class="form-control" id="close-1"></select></td>
                                            </tr>
                                            <tr>
                                                <td>Terça</td>
                                                <td><select class="form-control" id="open-2"></select></td>
                                                <td><select class="form-control" id="close-2"></select></td>
                                            </tr>
                                            <tr>
                                                <td>Quarta</td>
                                                <td><select class="form-control" id="open-3"></select></td>
                                                <td><select class="form-control" id="close-3"></select></td>
                                            </tr>
                                            <tr>
                                                <td>Quinta</td>
                                                <td><select class="form-control" id="open-4"></select></td>
                                                <td><select class="form-control" id="close-4"></select></td>
                                            </tr>
                                            <tr>
                                                <td>Sexta</td>
                                                <td><select class="form-control" id="open-5"></select></td>
                                                <td><select class="form-control" id="close-5"></select></td>
                                            </tr>
                                            <tr>
                                                <td>Sábado</td>
                                                <td><select class="form-control" id="open-6"></select></td>
                                                <td><select class="form-control" id="close-6"></select></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <button type="submit" class="btn btn-primary mt-3">Salvar Horários</button>
                            </form>
                            <div id="horariosMsg" class="mt-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIM Horários Section -->
    <!-- Seção de Clientes -->
    <div class="content-section" id="customers-section">
            <div class="row mb-4">
                <div class="col-lg-4 mb-4">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-primary">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="totalCustomers">0</h3>
                            <p>Total de Clientes</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-success">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="newCustomers">0</h3>
                            <p>Novos Clientes</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="kpi-card">
                        <div class="kpi-icon bg-info">
                            <i class="fas fa-redo"></i>
                        </div>
                        <div class="kpi-content">
                            <h3 id="returningCustomers">0</h3>
                            <p>Clientes Recorrentes</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <div class="col-lg-8 mb-4">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h5><i class="fas fa-chart-area mr-2"></i>Gastos dos Clientes</h5>
                        </div>
                        <div class="chart-body">
                            <canvas id="customerSpendingChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h5><i class="fas fa-chart-doughnut mr-2"></i>Distribuição de Gastos</h5>
                        </div>
                        <div class="chart-body">
                            <canvas id="spendingDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="table-card">
                        <div class="table-header">
                            <h5><i class="fas fa-crown mr-2"></i>Top Clientes</h5>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="topCustomersTable">
                                <thead>
                                    <tr>
                                        <th>Ranking</th>
                                        <th>Cliente</th>
                                        <th>Total Gasto</th>
                                        <th>Nº Pedidos</th>
                                        <th>Ticket Médio</th>
                                        <th>Último Pedido</th>
                                        <th>Bairro</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados serão inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Seção de Localização (análise por bairro, endereços, CEPs) -->
    <div class="content-section" id="locations-section">
            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs mb-4" id="locationTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <a class="nav-link active" id="overview-tab" data-toggle="tab" href="#overview-tab-content" role="tab">
                        <i class="fas fa-chart-bar"></i> Visão Geral
                    </a>
                </li>
                <li class="nav-item" role="presentation">
                    <a class="nav-link" id="addresses-tab" data-toggle="tab" href="#addresses-tab-content" role="tab">
                        <i class="fas fa-map-marker-alt"></i> Endereços e CEPs
                    </a>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="locationTabContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="overview-tab-content" role="tabpanel">
                    <div class="row mb-4">
                        <div class="col-lg-8 mb-4">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5><i class="fas fa-map-marked-alt mr-2"></i>Pedidos por Bairro</h5>
                                </div>
                                <div class="chart-body">
                                    <canvas id="locationChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 mb-4">
                            <div class="chart-card">
                                <div class="chart-header">
                                    <h5><i class="fas fa-list mr-2"></i>Bairros que Mais Pedem</h5>
                                </div>
                                <div class="chart-body">
                                    <ol id="topBairrosList" class="pl-3" style="font-size:1rem;"></ol>
                                </div>
                                <!-- JS para ranking dinâmico dos bairros reais -->
                                <script>
                                async function getBairroByCep(cep) {
                                    try {
                                        const cepLimpo = (cep || '').replace(/\D/g, '');
                                        if (cepLimpo.length !== 8) return null;
                                        const response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
                                        const data = await response.json();
                                        if (data.erro) return null;
                                        return data.bairro || null;
                                    } catch {
                                        return null;
                                    }
                                }

                                async function renderBairroRankingReal() {
                                    // Busca pedidos reais do localStorage
                                    const orders = JSON.parse(localStorage.getItem('lrGourmetOrders')) || [];
                                    const bairroCount = {};
                                    for (const order of orders) {
                                        let bairro = order.bairro;
                                        if (order.cep) {
                                            const bairroReal = await getBairroByCep(order.cep);
                                            if (bairroReal) bairro = bairroReal;
                                        }
                                        if (!bairro) bairro = 'N/A';
                                        if (!bairroCount[bairro]) bairroCount[bairro] = 0;
                                        bairroCount[bairro]++;
                                    }
                                    // Ordena e pega os 4 mais pedidos
                                    const bairrosOrdenados = Object.entries(bairroCount)
                                        .sort((a, b) => b[1] - a[1])
                                        .slice(0, 4);
                                    const html = bairrosOrdenados.map(([bairro, pedidos]) =>
                                        `<li class="bairro-list-item"><i class="fas fa-map-marker-alt text-primary mr-2"></i> <span class="bairro-nome">${bairro}</span> <span class="badge badge-success ml-2">${pedidos} pedidos</span></li>`
                                    ).join('');
                                    document.getElementById('topBairrosList').innerHTML = html;
                                }
                                document.addEventListener('DOMContentLoaded', renderBairroRankingReal);
                                // Atualiza em tempo real quando pedidos mudam
                                window.addEventListener('storage', function(e) {
                                    if (e.key === 'lrGourmetOrders') renderBairroRankingReal();
                                });
                                </script>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="table-card">
                                <div class="table-header">
                                    <h5><i class="fas fa-map-pin mr-2"></i>Análise por Localização</h5>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover" id="locationsTable">
                                        <thead>
                                            <tr>
                                                <th>Bairro</th>
                                                <th>Nº Pedidos</th>
                                                <th>Receita Total</th>
                                                <th>Ticket Médio</th>
                                                <th>% do Total</th>
                                                <th>Taxa de Entrega</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Dados serão inseridos via JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Addresses Tab -->
                <div class="tab-pane fade" id="addresses-tab-content" role="tabpanel">
                    <div class="row mb-4">
                        <!-- Address Statistics Cards -->
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="kpi-card">
                                <div class="kpi-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="kpi-content">
                                    <h3 id="totalAddresses">0</h3>
                                    <p>Endereços Únicos</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="kpi-card">
                                <div class="kpi-icon">
                                    <i class="fas fa-mail-bulk"></i>
                                </div>
                                <div class="kpi-content">
                                    <h3 id="totalCeps">0</h3>
                                    <p>CEPs Diferentes</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="kpi-card">
                                <div class="kpi-icon">
                                    <i class="fas fa-route"></i>
                                </div>
                                <div class="kpi-content">
                                    <h3 id="avgDeliveryFee">R$ 0,00</h3>
                                    <p>Taxa Média</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="kpi-card">
                                <div class="kpi-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="kpi-content">
                                    <h3 id="repeatCustomers">0</h3>
                                    <p>Clientes Recorrentes</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Address Table -->
                    <div class="table-card">
                        <div class="table-header d-flex justify-content-between align-items-center">
                            <h5><i class="fas fa-list mr-2"></i>Detalhamento de Endereços por Cliente</h5>
                            <div class="chart-controls">
                                <button class="btn btn-sm btn-success" id="exportAddresses">
                                    <i class="fas fa-download"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="addressesTable">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Endereço Completo</th>
                                        <th>CEP</th>
                                        <th>Bairro</th>
                                        <th>Pedidos</th>
                                        <th>Último Pedido</th>
                                        <th>Taxa de Entrega</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados serão inseridos via JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Seção de Relatórios Personalizados -->
    <div class="content-section" id="reports-section">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle mr-2"></i>
                        <strong>Relatórios Personalizados</strong> - Selecione o período e tipo de relatório desejado.
                    </div>
                </div>
            </div>
            <div class="row mb-4">
                <form id="reportForm" class="w-100 d-flex flex-row flex-wrap">
                    <div class="col-lg-4 mb-3">
                        <div class="form-group">
                            <label for="reportType">Tipo de Relatório</label>
                            <select class="form-control" id="reportType" name="reportType">
                                <option value="sales">Relatório de Vendas</option>
                                <option value="products">Relatório de Produtos</option>
                                <option value="customers">Relatório de Clientes</option>
                                <option value="locations">Relatório de Localizações</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-3 mb-3">
                        <div class="form-group">
                            <label for="reportStartDate">Data Inicial</label>
                            <input type="date" class="form-control" id="reportStartDate" name="reportStartDate">
                        </div>
                    </div>
                    <div class="col-lg-3 mb-3">
                        <div class="form-group">
                            <label for="reportEndDate">Data Final</label>
                            <input type="date" class="form-control" id="reportEndDate" name="reportEndDate">
                        </div>
                    </div>
                    <div class="col-lg-2 mb-3">
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="submit" class="btn btn-primary btn-block" id="generateReport">
                                <i class="fas fa-chart-bar mr-2"></i>Gerar
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="table-card" id="reportResults" style="display: none;">
                        <div class="table-header">
                            <h5 id="reportTitle"><i class="fas fa-file-alt mr-2"></i>Resultado do Relatório</h5>
                            <button class="btn btn-sm btn-success" id="exportReport">
                                <i class="fas fa-file-excel mr-2"></i>Exportar Excel
                            </button>
                        </div>
                        <div class="table-responsive">
                            <div id="reportContent">
                                <!-- Conteúdo do relatório será inserido aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Scripts principais do dashboard -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.1/dist/jspdf.plugin.autotable.min.js"></script>
        <script src="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.js"></script>
    <script src="dashboard-script.js"></script>

        <!-- Modal: Recortar Imagem -->
            <div class="modal fade" id="cropImageModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-xl" role="document" style="max-width:72vmin;">
                <div class="modal-content">
                    <div class="modal-header">
                            <h5 class="modal-title" title="Recortar"><i class="fas fa-crop-alt"></i></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                                <div class="modal-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <label class="mb-0 mr-2"><strong>Proporção:</strong></label>
                                        <select id="cropAspectSelect" class="form-control form-control-sm" style="max-width:180px;">
                                            <option value="free" selected>Livre</option>
                                            <option value="1">1 : 1</option>
                                            <option value="1.3333333333">4 : 3</option>
                                            <option value="1.7777777778">16 : 9</option>
                                            <option value="1.5">3 : 2</option>
                                            <option value="0.6666666667">2 : 3</option>
                                        </select>
                                    </div>
                            <div id="cropperSquare" class="mx-auto" style="width:68vmin; max-width:98vw; aspect-ratio:1/1; overflow:hidden;">
                                        <img id="cropperImage" src="" style="width:100%; height:100%; object-fit:contain; display:block;" />
                                    </div>
                                </div>
                    <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal" title="Cancelar">
                                <i class="fas fa-times"></i>
                            </button>
                            <button type="button" class="btn btn-danger" id="deleteImageInModal" title="Remover imagem" style="display:none;">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button type="button" class="btn btn-primary" id="confirmCropBtn" title="Aplicar">
                                <i class="fas fa-check"></i>
                            </button>
                    </div>
                </div>
            </div>
        </div>
</body>
</html>
